#### 小组成员
陈俊超, 蔡升豪, 余晓鹏, 陈博文

#### 讲解的内容
* 仓库的概念  
* 数据仓库的发展历程
* 数据库与数据仓库的联系和区别
* 数据仓库架构分层
* 元数据介绍
* 星型模型和雪花模型

#### 讲解的目的

* 使大家了解什么是数据仓库
* 使大家了解数据仓库的建立过程
* 使大家了解评价数据仓库优劣的标准

##### 数据仓库的概念  
* 数据仓库是什么  
数据仓库，英文名称为Data Warehouse，可简写为DW或DWH。  
数据仓库，是为企业所有级别的决策制定过程，提供所有类型数据支持的战略集合。  
数据仓库出于分析性报告和决策支持目的而创建，为需要业务智能的企业，提供指导业务流程改进、监视时间、成本、质量以及控制。

* 数据仓库的特点  
1. 数据仓库的数据是面向主题的  
与传统数据库面向应用进行数据组织的特点相对应，数据仓库中的数据是面向主题进行组织的。什么是主题呢？首先，主题是一个抽象的概念，是较高层次上企业信息系统中的数据综合、归类并进行分析利用的抽象。在逻辑意义上，它是对应企业中某一宏观分析领域所涉及的分析对象。面向主题的数据组织方式，就是在较高层次上对分析对象的数据的一个完整、一致的描述，能完整、统一地刻划各个分析对象所涉及的企业的各项数据，以及数据之间的联系。所谓较高层次是相对面向应用的数据组织方式而言的，是指按照主题进行数据组织的方式具有更高的数据抽象级别。

2. 数据仓库的数据是集成的  
数据仓库的数据是从原有的分散的数据库数据抽取来的。操作型数据与DSS分析型数据之间差别甚大。第一，数据仓库的每一个主题所对应的源数据在原有的各分散数据库中有许多重复和不一致的地方，且来源于不同的联机系统的数据都和不同的应用逻辑捆绑在一起；第二，数据仓库中的综合数据不能从原有的数据库系统直接得到。因此在数据进入数据仓库之前，必然要经过统一与综合，这一步是数据仓库建设中最关键、最复杂的一步，所要完成的工作有：

（1）要统一源数据中所有矛盾之处，如字段的同名异义、异名同义、单位不统一、字长不一致等。

（2）进行数据综合和计算。数据仓库中的数据综合工作可以在从原有数据库抽取 数据时生成，但许多是在数据仓库内部生成的，即进入数据仓库以后进行综合生成的。

3. 数据仓库的数据是不可更新的  
数据仓库的数据主要供企业决策分析之用，所涉及的数据操作主要是数据查询，一般情况下并不进行修改操作。数据仓库的数据反映的是一段相当长的时间内历史数据的内容，是不同时点的数据库快照的集合，以及基于这些快照进行统计、综合和重组的导出数据，而不是联机处理的数据。数据库中进行联机处理的数据经过集成输入到数据仓库中，一旦数据仓库存放的数据已经超过数据仓库的数据存储期限，这些数据将从当前的数据仓库中删去。因为数据仓库只进行数据查询操作，所以数据仓库管理系统相比数据库管理系统而言要简单得多。数据库管理系统中许多技术难点，如完整性保护、并发控制等等，在数据仓库的管理中几乎可以省去。但是由于数据仓库的查询数据量往往很大，所以就对数据查询提出了更高的要求，它要求采用各种复杂的索引技术；同时由于数据仓库面向的是商业企业的高层管理者，他们会对数据查询的界面友好性和数据表示提出更高的要求。

4. 数据仓库的数据是随时间不断变化的  
数据仓库中的数据不可更新是针对应用来说的，也就是说，数据仓库的用户进行分析处理时是不进行数据更新操作的。但并不是说，在从数据集成输入数据仓库开始到最终被删除的整个数据生存周期中，所有的数据仓库数据都是永远不变的。

数据仓库的数据是随时间的变化而不断变化的，这是数据仓库数据的第四个特征。这一特征表现在以下3方面：

（1）数据仓库随时间变化不断增加新的数据内容。数据仓库系统必须不断捕捉OLTP数据库中变化的数据，追加到数据仓库中去，也就是要不断地生成OLTP数据库的快照，经统一集成后增加到数据仓库中去；但对于确实不再变化的数据库快照，如果捕捉到新的变化数据，则只生成一个新的数据库快照增加进去，而不会对原有的数据库快照进行修改。

（2）数据仓库随时间变化不断删去旧的数据内容。数据仓库的数据也有存储期限，一旦超过了这一期限，过期数据就要被删除。只是数据仓库内的数据时限要远远长于操作型环境中的数据时限。在操作型环境中一般只保存有60~90天的数据，而在数据仓库中则需要保存较长时限的数据（如5~10年），以适应DSS进行趋势分析的要求。

（3）数据仓库中包含有大量的综合数据，这些综合数据中很多跟时间有关，如数据经常按照时间段进行综合，或隔一定的时间片进行抽样等等。这些数据要随着时间的变化不断地进行重新综合。因此，数据仓库的数据特征都包含时间项，以标明数据的历史时期。

##### 数据仓库的发展历程
* 数据仓库的由来:
    1. 需求和技术的进步  
        需求的变化- 业务系统的逐渐完善 分析需求的不断增加 不断增加的信息孤岛导致数据集成问题不断增加
        技术发展的变化- 关系数据库技术日趋成熟 报表和复杂查询处理起来非常困难 各个系统之间数据不一致
        
    2. 数据仓库应运而生: 为分析人员和决策层服务
        定义: 是一个支持管理决策的数据集合.
        特点: 面向主题的 集成的 稳定的 翻领历史变化.
        面向主题: 主要是和分析相关的,有特定的服务场景,比如银行投资vip用户的理财方式的分析,可以以vip相关用户为主题生成相关数据报表.
        集成的:
        稳定的: 一般是由分析人员作读操作,写操作比较少,而且数据变动不大,比较稳定
        反应历史变化情况: 数据仓库可以存储不同时间的数据情况,例如2017-2019的财务状况.
        数据仓库是所有操作环境和外部数据源的快照集合: 类似于虚拟机的快照,能够反应历史变化       

* 阶段一：简单报表阶段：  
这个阶段，系统的主要目标是解决一些日常的工作中业务人员需要的报表，以及生成一些简单的能够帮助领导进行决策所需要的汇总数据。这个阶段的大部分表现形式为数据库和前端报表工具。

* 阶段二：数据集市阶段  
这个阶段，主要是根据某个业务部门的需要，进行一定的数据的采集，整理，按照业务人员的需要，进行多维报表的展现，能够提供对特定业务指导的数据，并且能够提供特定的领导决策数据。
* 阶段三：数据仓库阶段  
这个阶段，主要是按照一定的数据模型，对整个企业的数据进行采集，整理，并且能够按照各个业务部门的需要，提供跨部门的，完全一致的业务报表数据，能够通过数据仓库生成对对业务具有指导性的数据，同时，为领导决策提供全面的数据支持。

*总结：通过数据仓库建设的发展阶段，我们能够看出，数据仓库的建设和数据集市的建设的重要区别就在于数据模型的支持。因此，数据模型的建设，对于我们数据仓库的建设，有着决定性的意义。

##### 数据库与数据仓库的联系和区别
*概念：数据库软件、数据库、数据仓库

* 数据库软件：本质为软件，是一种软件，可以看得见，可以操作。用来实现数据库逻辑功能。属于物理层。  
* 数据库： 是一种逻辑概念，用来存放数据的仓库。通过数据库软件来实现。数据库由很多表组成，表是二维的，一张表里可以有很多字段。字段一字排开，对应的数据就一行一行写入表中。数据库的表，在于能够用二维表现多维关系。目前市面上流行的数据库都是二维数据库。如：Oracle、DB2、MySQL、Sybase、MS SQL Server等。
* 数据仓库：是数据库概念的升级。从逻辑上理解，数据库和数据仓库没有区别，都是通过数据库软件实现的存放数据的地方，只不过从数据量来说，数据仓库要比数据库更庞大得多。数据仓库主要用于数据挖掘和数据分析，辅助领导做决策。

* 对数据库的理解
在IT的架构体系中，数据库是必须存在的。必须要有地方存放数据。比如现在的网购，淘宝，京东等等。物品的存货数量，货品的价格，用户的账户余额之类的。这些数据都是存放在后台数据库中。或者最简单理解，我们现在微博，QQ等账户的用户名和密码。在后台数据库必然有一张user表，字段起码有两个，即用户名和密码，然后我们的数据就一行一行的存在表上面。当我们登录的时候，我们填写了用户名和密码，这些数据就会被传回到后台去，去跟表上面的数据匹配，匹配成功了，你就能登录了。匹配不成功就会报错说密码错误或者没有此用户名等。这个就是数据库，数据库在生产环境就是用来干活的。凡是跟业务应用挂钩的，我们都使用数据库。

* 对数据仓库的理解  
数据仓库则是BI下的其中一种技术。由于数据库是跟业务应用挂钩的，所以一个数据库不可能装下一家公司的所有数据。数据库的表设计往往是针对某一个应用进行设计的。比如刚才那个登录的功能，这张user表上就只有这两个字段，没有别的字段了。但是这张表符合应用，没有问题。但是这张表不符合分析。比如我想知道在哪个时间段，用户登录的量最多？哪个用户一年购物最多？诸如此类的指标。那就要重新设计数据库的表结构了。对于数据分析和数据挖掘，我们引入数据仓库概念。数据仓库的表结构是依照分析需求，分析维度，分析指标进行设计的。

* 二者的区别  
*因此实际上二者的区别就是OLTP(On-Line Transaction Processing,联机事务处理)和OLAP(On-Line Analytical Processing，联机分析处理)的区别
*OLTP：操作型处理，叫联机事务处理OLTP（On-Line Transaction Processing），也可以称面向交易的处理系统，它是针对具体业务在数据库联机的日常操作，通常对少数记录进行查询、修改。用户较为关心操作的响应时间、数据的安全性、完整性和并发支持的用户数等问题。传统的数据库系统作为数据管理的主要手段，主要用于操作型处理。
*OLAP：分析型处理，叫联机分析处理OLAP（On-Line Analytical Processing）一般针对某些主题的历史数据进行分析，支持管理决策。
* OLAP vs OLTP

| ITEM      | OLTP | OLAP |
| :---:     | :---: | :--- |
| 用户      |操作人员|分析决策人员,高级管理人员|
| 功能      |日常操作处理|决策处理|
| 设计      |面向应用|面向主题|
| 数据 |当前的最新的细节的二维的分立的|历史的聚集的多维的集成的统一的|
| 存取 |读/写数十条记录|读上百万条记录
| 工作单位|简单的读写|复杂查询|
| DB大小 |GB-TB|TB-PB|
| 度量 |事务吞吐量|查询吞吐量 响应时间|

##### 数据仓库组成结构
* 数据仓库组成  
*数据仓库各组成部分如下：

![说明图片](https://img2018.cnblogs.com/blog/832918/201905/832918-20190524110506847-2092567698.png)

    1. 数据仓库  
        数据仓库是整个数据仓库环境的核心，是数据存放的地方和提供数据检索的支持。相对于操作型数据库来说，其特点就是对海量数据的支持和快速的检索技术。
    2. 抽取工具 
        抽取工具把数据从各种各样的存储环境中提取出来，进行必要的转化、整理，再存放到数据仓库。
    3. 元数据  
        元数据是关于数据的数据，在数据仓库中元数据位于数据仓库的上层，是描述数据仓库内数据的结构、位置和建立方法的数据。
        通俗来讲，是关于数据的数据，可以看作是数据仓库系统的“数据字典”，但是这个字典比传统意义上的数据字典强大。
        他可以帮助管理员和开发人员方便找到他们所关心的数据，并告诉用户数据仓库中有哪些数据，这些数据从哪里来
    4. 数据集市  
        数据仓库是构建数据仓库时经常用到的一个词汇。如果说数据仓库是企业范围的，收集关于整个组织的主题，如顾客、商品、销售、资产和人员等方面的信息，那么数据集市则是包含企业范围数据的一个子集，例如：只包含销售主题的数据。数据集市只存放某个主题的数据，其目的是减少数据处理量，使信息的利用更加快捷和灵活。
    5. OLAP服务  
        OLAP服务是指对存储在数据仓库中的数据提供分析的一种软件，它能够快速提供复杂数据查询和聚集，并帮助用户分析多维数据中的各维情况。
    6. 数据报表、数据分析和数据挖掘
        数据报表、数据分析和数据挖掘为用户产生的各种数据分析和汇总报表，以及数据挖掘结果

###### ETL介绍
*ETL分别是Extract、Transform、Load三个单词的首字母缩写，也就是抽取、转换、装载。ETL是数据仓库的灵魂。

1. 数据抽取  
    数据抽取是将数据从各种原始的业务系统中读取出来，这是所有工作的前提。数据抽取要做到既能满足决策的需要，又不影响业务系统的性能，所以进行数据抽取的时候需要制定相应的策略，包括抽取方式、抽取时机、抽取周期等内容；

2. 数据转换
    数据转换是按照预先设定的规则将抽取的数据进行转换，使本来异构的数据格式能够统一起来  
    例如：在业务系统中本来不存在的指标需要在转换过程中计算衍生出来。

3.数据装载
    数据装载是将转换完的数据按照计划增量或全部导入到数据仓库中。一般情况下，数据装载应该在系统完成了更新之后进行。
    数据装载包括：基本装载、追加装载、破坏性合并和建设性合并等方式。、
    
###### 元数据介绍
*当需要了解某地企业及其提供的服务时，电话黄页的重要性就体现出来了。元数据（Metadata）类似于这样的电话黄页。
* 元数据的定义  
    1. 数据仓库的元数据是关于数据仓库中数据的数据。它的作用类似于数据库管理系统的数据字典，保存了逻辑数据结构、文件、地址和索引等信息。广义上讲，在数据仓库中，元数据描述了数据仓库内数据的结构和建立方法的数据
    2. 元数据是数据仓库管理系统的重要组成部分，元数据管理器是企业级数据仓库中的关键组件，贯穿数据仓库构建的整个过程，直接影响着数据仓库的构建、使用和维护。
        （1）构建数据仓库的主要步骤之一是ETL。这时元数据将发挥重要的作用，它定义了源数据系统到数据仓库的映射、数据转换的规则、数据仓库的逻辑结构、数据更新的规则、数据导入历史记录以及装载周期等相关内容。数据抽取和转换的专家以及数据仓库管理员正是通过元数据高效地构建数据仓库。

        （2）用户在使用数据仓库时，通过元数据访问数据，明确数据项的含义以及定制报表。

        （3）数据仓库的规模及其复杂性离不开正确的元数据管理，包括增加或移除外部数据源，改变数据清洗方法，控制出错的查询以及安排备份等。
        
     3. 元数据可分为技术元数据和业务元数据。技术元数据为开发和管理数据仓库的IT人员使用，它描述了与数据仓库开发、管理和维护相关的数据，包括数据源信息、数据转换描述、数据仓库模型、数据清洗与更新规则、数据映射和访问权限等。而业务元数据为管理层和业务分析人员服务，从业务角度描述数据，包括商务术语、数据仓库中有什么数据、数据的位置和数据的可用性等，帮助业务人员更好地理解数据仓库中哪些数据是可用的以及如何使用。  
     
*由上可见，元数据不仅定义了数据仓库中数据的模式、来源、抽取和转换规则等，而且是整个数据仓库系统运行的基础，元数据把数据仓库系统中各个松散的组件联系起来，组成了一个有机的整体，如图所示:

![说明图片](https://images2018.cnblogs.com/blog/1385722/201806/1385722-20180602175746640-579846309.png)

* 元数据的存储方式  
1. 以数据集为基础：一种是以数据集为基础，每一个数据集有对应的元数据文件，每一个元数据文件包含对应数据集的元数据内容；
2. 以数据库为基础：元数据库  
    其中元数据文件由若干项组成，每一项表示元数据的一个要素，每条记录为数据集的元数据内容。上述存储方式各有优缺点，第一种存储方式的优点是调用数据时相应的元数据也作为一个独立的文件被传输，相对数据库有较强的独立性，在对元数据进行检索时可以利用数据库的功能实现，也可以把元数据文件调到其他数据库系统中操作；不足是如果每一数据集都对应一个元数据文档，在规模巨大的数据库中则会有大量的元数据文件，管理不方便。第二种存储方式下，元数据库中只有一个元数据文件，管理比较方便，添加或删除数据集，只要在该文件中添加或删除相应的记录项即可。在获取某数据集的元数据时，因为实际得到的只是关系表格数据的一条记录，所以要求用户系统可以接受这种特定形式的数据。因此推荐使用元数据库的方式。
    元数据库用于存储元数据，因此元数据库最好选用主流的关系数据库管理系统。元数据库还包含用于操作和查询元数据的机制。建立元数据库的主要好处是提供统一的数据结构和业务规则，易于把企业内部的多个数据集市有机地集成起来。目前，一些企业倾向建立多个数据集市，而不是一个集中的数据仓库，这时可以考虑在建立数据仓库（或数据集市）之前，先建立一个用于描述数据、服务应用集成的元数据库，做好数据仓库实施的初期支持工作，对后续开发和维护有很大的帮助。元数据库保证了数据仓库数据的一致性和准确性，为企业进行数据质量管理提供基础。
    
    ![说明图片](https://ask.qcloudimg.com/http-save/developer-news/r233gfhv17.jpeg?imageView2/2/w/1620)
    
###### 数据仓库与数据集市
1. 数据集市的类型
    ![说明图片](https://img2018.cnblogs.com/blog/832918/201905/832918-20190524110508890-204072917.png)  
    
    * 从属型数据集市  
    所谓从属就是指它的数据直接来自中央数据仓库。这种结构能保持数据的一致性，通常会为那些访问数据仓库十分频繁的关键业务部门建立从属数据集市，这样能更好的提高查询操作的反应速度。
    ![说明图片](https://img2018.cnblogs.com/blog/832918/201905/832918-20190524110510649-1791310114.png)

    * 独立性数据集市
    ![说明图片](https://img2018.cnblogs.com/blog/832918/201905/832918-20190524110511245-1050673769.png)
    
2. 数据仓库于数据集市区别  
    （1）数据仓库向各个数据集市提供数据，前者是企业级的，规模较大，后者是部门级的，规模相对较小。
    （2）若干部门的数据集市组合在一起成为一个数据仓库。数据集市开发周期短、速度快，数据仓库开发周期长、速度慢。
    （3）从其数据特征进行分析，数据仓库采用范式设计，但是数据集市中的数据结构采用星型模式。通常数据仓库的粒度要比数据集市的粒度细。
    
###### 维、维度表、事实表
*通俗理解：一个典型的例子是，把逻辑业务比作一个立方体，产品维、时间维、地点维分别作为不同的坐标轴，而坐标轴的交点就是一个具体的事实。也就是说事实表是多个维度表的一个交点。而维度表是分析事实的一个窗口。 

1. 维
    维是人们观察数据的特定角度，是考虑问题时的一类属性，属性集合构成一个维。如：时间维、地理维等。
    
2. 维度表
    维度表是维度属性的集合。是分析问题的一个窗口。是人们观察数据的特定角度，是考虑问题时的一类属性，属性的集合构成一个维。
    
3. 事实表
    事实表是数据仓库结构中的中央表，它包含联系事实与维度表的数字度量值和键。事实数据表包含描述业务（例如产品销售）内特定事件的数据。
    
4. 二者联系
    事实表包含一个或多个部分组成的索引，该索引包含作为外键的相关性维度表的主键，而维度表包含事实记录的特性；
    一个事实表往往和多个维度表关联，而二者之间不同的关联方式，构成了不同的模型；
    
###### 多维数据模型
*在多维分析的商业智能解决方案中，根据事实表和维度表的关系，又可将常见的模型分为星型模型、雪花型模型和事实星座模型。

1. 星型模型 
*当所有维表都直接连接到“ 事实表”上，其核心为一个大的中心表(事实表)，一组小的附属表(维表)，形如星状，故将该模型称为星型模型。  

    ![说明图片](https://images2018.cnblogs.com/blog/1385722/201806/1385722-20180602175922478-1199871973.png)  
    星型架构是一种非正规化的结构，多维数据集的每一个维度都直接与事实表相连接，不存在渐变维度，所以数据有一定的冗余，如在地域维度表中，存在国家A 省B的城市C以及国家A省B的城市D两条记录，那么国家A和省B的信息分别存储了两次，即存在冗余。
    
2. 星系模式  
*数据仓库由多个主题构成，包含多个事实表，而维表是公共的，可以共享，这种模式可以看做星型模式的汇集，因而称作星系模式或者事实星座模式。
    
    ![说明图片](https://images0.cnblogs.com/blog/496966/201501/200924338912918.jpg)
    如上图所示，事实星座模式包含两个事实表：sales和shipping，二者共享维表。

3. 雪花模型  
*雪花模式是星型模式的扩展，其中某些维表被规范化，进一步分解到附加表（维表）中，它的优点是：通过最大限度地减少数据存储量以及联合较小的维表来改善查询性能。雪花型结构去除了数据冗余。
    
     ![说明图片](https://images2018.cnblogs.com/blog/1385722/201806/1385722-20180602180038798-922306929.png)
     星型模型因为数据的冗余所以很多统计查询不需要做外部的连接，因此一般情况下效率比雪花型模型要高。星型结构不用考虑很多正规化的因素，设计与实现都比较简单。雪花型模型由于去除了冗余，有些统计就需要通过表的联接才能产生，所以效率不一定有星型模型高。正规化也是一种比较复杂的过程，相应的数据库结构设计、数据的 ETL、以及后期的维护都要复杂一些。因此在冗余可以接受的前提下，实际运用中星型模型使用更多，也更有效率。  

3. 二者对比 
*星形模型和雪花模型是数据仓库中常用到的两种基本方式，而它们之间的对比要从四个角度来进行讨论。

* 数据优化  
    雪花模型使用的是规范化数据，也就是说数据在数据库内部是组织好的，以便消除冗余，因此它能够有效地减少数据量。通过引用完整性，其业务层级和维度都将存储在数据模型之中。
    ![说明](https://images2018.cnblogs.com/blog/1385722/201806/1385722-20180602180138807-2078292978.png)
    相比较而言，星形模型使用的是反规范化数据。在星形模型中，维度直接指的是事实表，业务层级不会通过维度之间的参照完整性来部署。
    ![说明](https://images2018.cnblogs.com/blog/1385722/201806/1385722-20180602180206665-1276325337.png)
    
* 业务模型  
    主键是一个单独的唯一键(数据属性)，为特殊数据所选择。在上面的例子中，Advertiser_ID就将是一个主键。外键(参考属性)仅仅是一个表中的字段，用来匹配其他维度表中的主键。在我们所引用的例子中，Advertiser_ID将是Account_dimension的一个外键。
    在雪花模型中，数据模型的业务层级是由一个不同维度表主键-外键的关系来代表的。而在星形模型中，所有必要的维度表在事实表中都只拥有外键。

* 性能  
    第三个区别在于性能的不同。雪花模型在维度表、事实表之间的连接很多，因此性能方面会比较低。举个例子，如果你想要知道Advertiser 的详细信息，雪花模型就会请求许多信息，比如Advertiser Name、ID以及那些广告主和客户表的地址需要连接起来，然后再与事实表连接。
    而星形模型的连接就少的多，在这个模型中，如果你需要上述信息，你只要将Advertiser的维度表和事实表连接即可。
   
* ETL
    雪花模型加载数据集市，因此ETL操作在设计上更加复杂，而且由于附属模型的限制，不能并行化。
    星形模型加载维度表，不需要再维度之间添加附属模型，因此ETL就相对简单，而且可以实现高度的并行化。     

###### 数据仓库模型设计举例
